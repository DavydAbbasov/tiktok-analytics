definitions:
  handlers.ErrorResponse:
    properties:
      error:
        type: string
      message:
        type: string
    type: object
  models.TrackVideoRequest:
    properties:
      tiktok_id:
        example: "1234567890"
        type: string
      url:
        example: https://www.tiktok.com/@user/video/1234567890
        type: string
    type: object
  models.TrackVideoResponse:
    properties:
      created_at:
        example: "2025-11-24T01:30:00Z"
        type: string
      currency:
        example: USD
        type: string
      current_earnings:
        example: 1.5
        type: number
      current_views:
        example: 15000
        type: integer
      last_updated_at:
        example: "2025-11-24T01:30:00Z"
        type: string
      status:
        example: active
        type: string
      tiktok_id:
        example: "1234567890"
        type: string
      title:
        example: My viral video
        type: string
      url:
        example: https://www.tiktok.com/@user/video/1234567890
        type: string
      video_id:
        example: 1
        type: integer
    type: object
  models.VideoHistoryResponse:
    properties:
      history_video:
        items:
          $ref: '#/definitions/models.VideoStatPoint'
        type: array
      video_id:
        type: integer
    type: object
  models.VideoStatPoint:
    properties:
      captured_at:
        type: string
      earnings:
        type: number
      views:
        type: integer
    type: object
info:
  contact: {}
paths:
  /api/videos:
    post:
      consumes:
      - application/json
      description: |-
        If the video is not yet tracked, the service:
        1) validates the URL/ID,
        2) fetches fresh stats from the provider,
        3) creates a new video record in the DB and writes the first stats snapshot.
        If the video is already tracked, the service DOES NOT call the provider.
        It returns the latest saved views and earnings from the `videos` table
        and also appends a new row to the hourly stats journal.
      parameters:
      - description: Video URL or TikTok ID
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.TrackVideoRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.TrackVideoResponse'
        "400":
          description: Invalid URL/ID
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Video not found on TikTok
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "429":
          description: Provider rate limit
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      summary: TrackVideo TikTok video for tracking
      tags:
      - videos
  /api/videos/{tiktok_id}:
    get:
      consumes:
      - application/json
      description: |-
        Returns the last saved views and earnings for a TikTok video
        from the `videos` table. Does NOT call external provider.
      parameters:
      - description: TikTok video ID
        in: path
        name: tiktok_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.TrackVideoResponse'
        "400":
          description: Invalid TikTok ID
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Video not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      summary: Get latest saved TikTok video stats
      tags:
      - videos
  /api/videos/{video_id}/history:
    get:
      consumes:
      - application/json
      description: |-
        Returns saved history of views and earnings for a TikTok video from `video_stats` table.
        Does NOT call external provider, uses only stored snapshots.
      parameters:
      - description: video_id video ID
        in: path
        name: video_id
        required: true
        type: string
      - description: 'Start time (unix seconds), inclusive. Example: 1732060800'
        format: int64
        in: query
        name: from
        type: integer
      - description: 'End time (unix seconds), exclusive. Example: 1732665600'
        format: int64
        in: query
        name: to
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.VideoHistoryResponse'
        "400":
          description: Invalid TikTok ID or invalid date params
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Video or history not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      summary: Get historical stats for a TikTok video
      tags:
      - videos
swagger: "2.0"
